Requirements
============

- JDK 7+
- Application server supporting Java EE 7 with EJB container support (Wildfly, Glassfish, ...)
- Database (PostgreSQL, MySQL, ...)

Production install guide
========================
For instance I will use Debian amd64 with Wildfly 8.2 application server, JDK 8 and PostgreSQL 8.4

1. Install JDK 8

   Download JDK from
        http://www.oracle.com/technetwork/java/javase/downloads/index.html
        in zip file form, for example jdk-8u45-linux-x64.tar.gz
   Extract archive to /usr/lib/jvm
   Setup enviroment variables for java 
   add these lines to the end of /etc/profile
        export JAVA_HOME=/usr/lib/jvm/jdk1.8.45        
        export PATH=$JAVA_HOME/bin
        
2. Install Wildfly 8.2.0

   Download zip from http://wildfly.org/downloads/
   Extract archive to the /usr/local
   In the newly extracted wildfly directory execute bin/add-user.sh and setup new wildfly administering user.
   
3. Start Wildfly by executing bin/standalone.sh

   Server should successfully start.
   If everything went OK:
   Server is running on http://localhost:8080/
   Admin console on http://localhost:9990/

4. Install and configure PostgreSQL database server

   apt-get install postgresql
   login as postgres "su - postgres" and run client "psql template1" 
   then type following commands to setup database for vocloud,
       CREATE USER vocloud WITH PASSWORD 'vocloud';
       CREATE DATABASE vocloud;
       GRANT ALL PRIVILEGES ON DATABASE vocloud TO vocloud;

   Note: You should really not use the same password as username. Do not forget to change it!

5. Configure database resource in Wildfly
	
   Log into Wildfly admin console: http://localhost:9990/
   Type in credentials of administrating user
   
   Download JDBC for PostgreSQL https://jdbc.postgresql.org/
   In the admin console navigate to Deployments
   Click Add, select downloaded JDBC .jar file and click Ok
   Enable newly uploaded JDBC driver
   
   Navigate to Configuration tab
   Select Datasources
   Click Add
   Name: VocloudDS
   JNDI Name: java:jboss/datasources/vocloud
   Click Next
   Select postgresql jdbc driver
   Click Next
   Connection URL: "jdbc:postgresql://localhost:5432/vocloud" (without quotes)
   Username: vocloud
   Password: vocloud
   Click Done
   Enable VocloudDS
   
   Datasource can be tested in section Connection > Test connection
   Ping should be successful

6. Configure e-mail resource in Wildfly
    
   It is necessary to have an email address which will serve as the source of emails. For instance I will use address vocloud@vocloud.org where SMTP is running on port 465 and the host address of the SMTP server is smtp.vocloud.org.
    
   Navigate to Configuration section
   Select Socket Binding
   Click View on standard-sockets
   Select Outbound Remote section
   Click Add
   Name: vocloud-smtp
   Host: smtp.vocloud.org
   Port: 465
   Click Save
   
   Navigate to Mail subsystem section
   Click Add
   JNDI Name: "java:jboss/mail/vocloud-mail" (without quotes)
   Click View on the newly created mail session
   Click Add
   Socket binding: vocloud-smtp
   Type: smtp
   Username: username to the email server
   Password: password to the email server
   Check use SSL (if the port is 465)
   Click Save

7. Configure security in WildFly

    Navigate to Security Domains in Configuration section
    Click Add
    Name: VocloudSecurityDomain
    Click Save
    Click View on the newly created security domain
    Click Add
    Code: Database
    Flag: required
    Click Save
    Now click on the newly created Login module
    Click on Module Options
    Add the following key=value pairs
        dsJndiName = java:jboss/datasources/vocloud
        principalsQuery = select pass from useraccount where username=?
        rolesQuery = select groupName, 'Roles' from useraccount where username=?
        hashAlgorithm = SHA-256
        hashEncoding = hex

8. Deploy vocloud.war to the Wildfly server

    Navigate to section Deployments
    Click Add
    Select vocloud.war file
    Submit
    Enable the vocloud.war
    
    VO-CLOUD should now run on http://localhost:8080/vocloud
   
   
9. Create admin account

    Using http://localhost:8080/vocloud/register.xhtml 
    Register a new account with username admin
    
    This account have now administrator privileges.
